#!/bin/sh

set -e

. ./util.sh

HELPDESK_FROM_USER="$(echo "${HELPDESK_FROM}" | _address_list_to_usernames)"
readonly HELPDESK_FROM_USER

if test -z "${HELPDESK_FROM_USER}"; then
    echo "$0: ERROR: invalid HELPDESK_FROM value '${HELPDESK_FROM}'" >&2
    exit 65 # EX_DATAERR
fi

# parse the subject line
read -r verb object param1 <<EOF
$HELPDESK_SUBJECT
EOF

case "${object}" in
    group*) taskname=groups ;;
esac

task="/empt/synced/bin/tasks/${taskname:-helpdesk_usage}.sh"
readonly task

doas "${task}" "${verb}" "${param1}"
