<!DOCTYPE html>
<html dir="auto" data-darkreader-mode="dynamic" data-darkreader-scheme="dark" class="wf-opensans-n4-inactive wf-lora-n4-active wf-active" lang="en"><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><style class="darkreader darkreader--fallback" media="screen"></style><style class="darkreader darkreader--text" media="screen"></style><style class="darkreader darkreader--invert" media="screen">.jfk-bubble.gtx-bubble, .captcheck_answer_label > input + img, span#closed_text > img[src^="https://www.gstatic.com/images/branding/googlelogo"], span[data-href^="https://www.hcaptcha.com/"] > #icon, #bit-notification-bar-iframe, ::-webkit-calendar-picker-indicator {
    filter: invert(100%) hue-rotate(180deg) contrast(90%) !important;
}</style><style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}
[data-darkreader-inline-stopcolor] {
  stop-color: var(--darkreader-inline-stopcolor) !important;
}</style><style class="darkreader darkreader--variables" media="screen">:root {
   --darkreader-neutral-background: #131516;
   --darkreader-neutral-text: #d8d4cf;
   --darkreader-selection-background: #004daa;
   --darkreader-selection-text: #e8e6e3;
}</style><style class="darkreader darkreader--root-vars" media="screen"></style><style class="darkreader darkreader--user-agent" media="screen">html {
    background-color: #181a1b !important;
}
html {
    color-scheme: dark !important;
}
html, body {
    background-color: #181a1b;
}
html, body {
    border-color: #736b5e;
    color: #e8e6e3;
}
a {
    color: #3391ff;
}
table {
    border-color: #545b5e;
}
::placeholder {
    color: #b2aba1;
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: #404400 !important;
    color: #e8e6e3 !important;
}
::-webkit-scrollbar {
    background-color: #202324;
    color: #aba499;
}
::-webkit-scrollbar-thumb {
    background-color: #454a4d;
}
::-webkit-scrollbar-thumb:hover {
    background-color: #575e62;
}
::-webkit-scrollbar-thumb:active {
    background-color: #484e51;
}
::-webkit-scrollbar-corner {
    background-color: #181a1b;
}
* {
    scrollbar-color: #454a4d #202324;
}
::selection {
    background-color: #004daa !important;
    color: #e8e6e3 !important;
}
::-moz-selection {
    background-color: #004daa !important;
    color: #e8e6e3 !important;
}</style>
		<meta charset="utf-8">

		<title>Subspace mailing list server — Konstantin Ryabitsev</title>
		
		<link rel="stylesheet" type="text/css" href="Subspace%20mailing%20list%20server%20%E2%80%94%20Konstantin%20Ryabitsev_files/write.css"><style class="darkreader darkreader--sync" media="screen"></style>
		<link rel="shortcut icon" href="https://people.kernel.org/favicon.ico">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<link rel="canonical" href="https://people.kernel.org/monsieuricon/subspace-mailing-list-server">
		<meta name="generator" content="WriteFreely">
		<meta name="title" content="Subspace mailing list server — Konstantin Ryabitsev">
		<meta name="description" content="We have recently announced the availability of our new mailing list platform that will eventually take on the duties currently performed ...">
		<meta name="twitter:label1" value="Views">
		<meta name="twitter:data1" value="3,348">
		<meta name="author" content="Konstantin Ryabitsev">
		<meta itemprop="description" content="We have recently announced the availability of our new mailing list platform that will eventually take on the duties currently performed ...">
		<meta itemprop="datePublished" content="2021-03-16">
		<meta name="twitter:card" content="summary">
		<meta name="twitter:description" content="We have recently announced the availability of our new mailing list platform that will eventually take on the duties currently performed ...">
		<meta name="twitter:title" content="Subspace mailing list server — Konstantin Ryabitsev">
		<meta name="twitter:image" content="https://people.kernel.org/img/avatars/k.png">
		<meta property="og:title" content="Subspace mailing list server">
		<meta property="og:description" content="We have recently announced the availability of our new mailing list platform that will eventually take on the duties currently performed ...">
		<meta property="og:site_name" content="Konstantin Ryabitsev">
		<meta property="og:type" content="article">
		<meta property="og:url" content="https://people.kernel.org/monsieuricon/subspace-mailing-list-server">
		<meta property="og:updated_time" content="2021-03-16T20:53:20Z">
		<meta property="og:image" content="https://people.kernel.org/img/avatars/k.png">
		<meta property="article:published_time" content="2021-03-16T20:53:20Z">
		
		

		

		
		
<script src="Subspace%20mailing%20list%20server%20%E2%80%94%20Konstantin%20Ryabitsev_files/webfont.js" type="text/javascript" async=""></script><script>
  
  addEventListener('DOMContentLoaded', function () {
    var hlbaseUri = "/js/";
    var lb = document.querySelectorAll("code[class^='language-']");


    
    var aliasmap = {
      "elisp"      : "lisp",
      "emacs-lisp" : "lisp",
      "c"          : "cpp",
      "cc"         : "cpp",
      "h"          : "cpp",
      "c++"        : "cpp",
      "h++"        : "cpp",
      "hpp"        : "cpp",
      "hh"         : "cpp",
      "hxx"        : "cpp",
      "cxx"        : "cpp",
      "sh"         : "bash",
      "js"         : "javascript",
      "jsx"        : "javascript",
      "html"       : "xml"
    };

    
    function highlight(nodes) {
      for (i=0; i < nodes.length; i++) {
          hljs.highlightBlock(nodes[i]);
      }
    }

    
    function loadLanguages(uris, callback) {
      uris.forEach(function(uri) {
        var sc = document.createElement('script');
        sc.src = uri;
        sc.async = false; 
	  
        if (uris.indexOf(uri) == uris.length-1) {
	  
	  
	  
          sc.onload  = callback; sc.onerror = callback;
        }
        document.head.appendChild(sc);
      });
    }

    
    if (lb.length > 0) {
      
      var st = document.createElement('link');
      st.rel = "stylesheet";
      st.href = "/css/lib/atom-one-light.min.css";
      document.head.appendChild(st);

      
      var jss = [hlbaseUri + "highlight.min.js"];
      
      for (i=0; i < lb.length; i++) {
        lang = lb[i].className.replace('language-','');
        
        if (aliasmap[lang]) lang = aliasmap[lang];
        lurl = hlbaseUri + "highlightjs/" + lang + ".min.js";
        if (!jss.includes(lurl)) {
          jss.push(lurl);
        }
      }
      
      loadLanguages(jss, () => {highlight(lb)});
    }
  });
</script>


	<meta name="darkreader" content="d8f904f228384f0a816648e509909437"><link rel="stylesheet" href="Subspace%20mailing%20list%20server%20%E2%80%94%20Konstantin%20Ryabitsev_files/fonts.css" media="all"><style class="darkreader darkreader--sync" media="screen"></style><style class="darkreader darkreader--override" media="screen">.vimvixen-hint {
    background-color: #7b5300 !important;
    border-color: #d8b013 !important;
    color: #f3e8c8 !important;
}
::placeholder {
    opacity: 0.5 !important;
}
#edge-translate-panel-body,
.MuiTypography-body1,
.nfe-quote-text {
    color: var(--darkreader-neutral-text) !important;
}
gr-main-header {
    background-color: #0f3a48 !important;
}
.tou-z65h9k,
.tou-mignzq,
.tou-1b6i2ox,
.tou-lnqlqk {
    background-color: var(--darkreader-neutral-background) !important;
}
.tou-75mvi {
    background-color: #032029 !important;
}
.tou-ta9e87,
.tou-1w3fhi0,
.tou-1b8t2us,
.tou-py7lfi,
.tou-1lpmd9d,
.tou-1frrtv8,
.tou-17ezmgn {
    background-color: #0a0a0a !important;
}
.tou-uknfeu {
    background-color: #231603 !important;
}
.tou-6i3zyv {
    background-color: #19576c !important;
}
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }</style></head>
	<body id="post">
		
		<div id="overlay"></div>

		<header>
		<h1 dir="auto" id="blog-title"><a rel="author" href="https://people.kernel.org/monsieuricon/" class="h-card p-author">Konstantin Ryabitsev</a></h1>
			<nav>
				
				
				
				
			</nav>
		</header>
		
		
		<article id="post-body" class="norm h-entry "><h2 id="title" class="p-name dated">Subspace mailing list server</h2><time class="dt-published" datetime="2021-03-16T20:53:20Z" pubdate="" itemprop="datePublished" content="2021-03-16 20:53:20 +0000 UTC">March 16, 2021</time><div class="e-content"><p>We have recently <a href="https://www.kernel.org/lists-linux-dev.html" rel="nofollow">announced</a> the availability of our new mailing list platform that will eventually take on the duties currently performed by <a href="http://vger.kernel.org/" rel="nofollow">vger</a>. Off the bat, there were a few questions about how it works under the hood — especially regarding DMARC-friendly cofiguration.</p>

<h2 id="under-the-hood">Under the hood</h2>

<p>There is nothing fancy about the setup — mailing lists are managed by <a href="http://mlmmj.org/" rel="nofollow">mlmmj</a>, while all delivery operations are handled by Postfix. All outgoing mail is delivered via kernel.org mirror edge nodes (see the output of <code>dig -t txt +short _spf.kernel.org</code> if you are curious what they are), which is mostly done to speed up delivery by spreading out the queue across several systems.</p>

<p>When mlmmj writes to the <code>archive</code> directory of the mailing list, the message is immediately picked up by <code>public-inbox-watch</code> and appended to the <a href="https://public-inbox.org/" rel="nofollow">public-inbox</a> archive for that list. The archive is then replicated to lore.kernel.org (using <a href="https://pypi.org/project/grokmirror/" rel="nofollow">grokmirror</a> integration), which usually happens within 60 seconds. This replication is parallel to Postfix delivering mail to list subscribers, so is not dependent on the size of the mail queue. In theory, it shouldn't take longer than a few minutes for a message sent to a lists.linux.dev address to show up on lore.kernel.org. Similarly, messages should never go missing from the public-inbox archive if they got accepted by mlmmj for delivery (I know, famous last words).</p>

<h2 id="appeasing-dmarc">Appeasing DMARC</h2>

<p>It's a common misconception that mailing lists are somehow incompatible with DMARC. There are two key principles to follow:</p>
<ol><li><p>The Envelope-From should be that of the mailing list domain. For example, if I send an email to linux-staging, the envelope-from of the outgoing message will be changed to <code>linux-staging+bounces-x@lists.linux.dev</code>, with some subscriber bounce tracking information in place of <code>x</code>. This way, when MTAs are looking at DMARC for “konstantin@linuxfoundation.org”, the SPF check will be performed against “lists.linux.dev” instead of the domain of the original sender (“linuxfoundation.org”).</p></li>

<li><p>There should be no changes to any of the existing message headers and no modifications to the message body. This is actually the part that generally trips up mailing list operators, as it is a long-standing practice to do two things when it comes to mailing lists: modify the subject to insert a terse list identifier (e.g. <code>Subject: [linux-staging] [PATCH] ...</code>) and append a footer to the message body with mailing list administrative info. Doing either of these things will almost certainly invalidate DKIM signatures and therefore cause the message to fail the DMARC check. It is correct to <em>add</em> proper <code>List-Id</code>/<code>List-Subscribe</code>/etc headers, though — and hopefully the domain of the original sender isn't misconfigured to include these headers into the DKIM signature (true story, saw this happen).</p></li></ol>

<p>Following the above advice will work for nearly all cases except where a domain sets a DMARC policy, but the message is sent without a DKIM signature. If this happens, DMARC validators are supposed to use a kludgy “alignment” check where the envelope-from must match the <code>From:</code> header. In that particular case the messages we send out will fail DMARC checks, unfortunately. As far as I'm concerned, this is the fault of domain owners and is properly fixed by setting up proper DKIM signing and giving users a way to send outgoing mail via proper SMTP gateways.</p>

<p>(There <em>is</em> a way to work around this by rewriting the “From: “ header so that it matches the list domain as well, but let's just not go there, as rewriting the From: header is not an acceptable solution for lists working with code reviews.)</p>

<p>Here's a write-up I randomly found while writing this post that goes into <a href="https://begriffs.com/posts/2018-09-18-dmarc-mailing-list.html" rel="nofollow">some more detail</a> regarding DMARC and mailing lists.</p>

<h2 id="why-no-arc-headers">Why no ARC headers?</h2>

<p>We don't currently add <a href="http://arc-spec.org/" rel="nofollow">ARC headers</a> — as far as I can tell, they aren't required for operating a mailing list that properly sets the envelope-from. In theory, using ARC signing may help with the “DMARC with no DKIM” corner-case above, but I'm not convinced this is worth the crazy header bloat. Who knows, I may change my mind about this in the future.</p>

<h2 id="parting-words">Parting words</h2>

<p>In short, the best way to assure that a message sent via subspace.kernel.org is delivered to all subscribers is to send it from a domain that properly DKIM-signs all mail. If you run your own server, you can either set up OpenDKIM on your own (it's not complicated, honest), or you can pay some money to a company like <a href="https://mailgun.com/" rel="nofollow">Mailgun</a> to do it for you.</p>
</div></article>

		
		<footer dir="ltr"><hr><nav><p style="font-size: 0.9em">published with <a href="https://writefreely.org/">writefreely</a></p></nav></footer>
		
	
	
	
	<script src="Subspace%20mailing%20list%20server%20%E2%80%94%20Konstantin%20Ryabitsev_files/localdate.js"></script>
	<script type="text/javascript">

var pinning = false;
function unpinPost(e, postID) {
	e.preventDefault();
	if (pinning) {
		return;
	}
	pinning = true;

	var $header = document.getElementsByTagName('header')[0];
	var callback = function() {
		
		var $pinnedNavLink = $header.getElementsByTagName('nav')[0].querySelector('.pinned.selected');
		$pinnedNavLink.style.display = 'none';
	};

	var $pinBtn = $header.getElementsByClassName('unpin')[0];
	$pinBtn.innerHTML = '...';

	var http = new XMLHttpRequest();
	var url = "/api/collections/monsieuricon/unpin";
	var params = [ { "id": postID } ];
	http.open("POST", url, true);
	http.setRequestHeader("Content-type", "application/json");
	http.onreadystatechange = function() {
		if (http.readyState == 4) {
			pinning = false;
			if (http.status == 200) {
				callback();
				$pinBtn.style.display = 'none';
				$pinBtn.innerHTML = 'Pin';
			} else if (http.status == 409) {
				$pinBtn.innerHTML = 'Unpin';
			} else {
				$pinBtn.innerHTML = 'Unpin';
				alert("Failed to unpin." + (http.status>=500?" Please try again.":""));
			}
		}
	}
	http.send(JSON.stringify(params));
};

	try { 
	  WebFontConfig = {
		custom: { families: [ 'Lora:400,700:latin', 'Open+Sans:400,700:latin' ], urls: [ '/css/fonts.css' ] }
	  };
	  (function() {
		var wf = document.createElement('script');
		wf.src = '/js/webfont.js';
		wf.type = 'text/javascript';
		wf.async = 'true';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(wf, s);
	  })();
	} catch (e) {   }
	</script>
</body></html>